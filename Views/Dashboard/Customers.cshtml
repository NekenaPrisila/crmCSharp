@using CRMSharp.ViewModels
@model DashboardViewModel
@{
    ViewData["Title"] = "Clients";
}

<h1 class="display-4">Gestion des Clients</h1>

<div class="mt-4">
    <!-- Contrôles de pagination en haut -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="dataTables_length">
                <label>
                    Afficher 
                    <select id="pageSizeSelect" class="form-select form-select-sm d-inline-block w-auto">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select> entrées
                </label>
            </div>
        </div>
        <div class="col-md-6 text-end">
            <div id="paginationInfo" class="dataTables_info"></div>
        </div>
    </div>
    
    <table id="customersTable" class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Country</th>
                <th>Address</th>
                <th>Budgets</th>
                <th>Depenses</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var customer in Model.Customers)
            {
                <tr>
                    <td>@customer.Id</td>
                    <td>@customer.Name</td>
                    <td>@customer.Email</td>
                    <td>@customer.Phone</td>
                    <td>@customer.Country</td>
                    <td>@customer.Address</td>
                    <td>@customer.Budget.ToString("0.00")</td>
                    <td>@customer.Expense.ToString("0.00")</td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Pagination en bas -->
    <div class="row">
        <div class="col-md-12">
            <div id="paginationControls" class="dataTables_paginate paging_simple_numbers">
                <ul class="pagination justify-content-center">
                    <!-- Boutons générés par jQuery -->
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Configuration de la pagination
            var table = $('#customersTable');
            var itemsPerPage = 10;
            var currentPage = 1;
            var rows = table.find('tbody tr');
            var rowsCount = rows.length;
            
            // Initialisation
            function initPagination() {
                $('#pageSizeSelect').val(itemsPerPage).change(function() {
                    itemsPerPage = parseInt($(this).val());
                    currentPage = 1;
                    updatePagination();
                });
                
                updatePagination();
            }
            
            // Afficher les lignes de la page courante
            function showPage(page) {
                var startIndex = (page - 1) * itemsPerPage;
                var endIndex = startIndex + itemsPerPage;
                
                rows.hide();
                rows.slice(startIndex, endIndex).show();
                updatePaginationInfo();
            }
            
            // Mettre à jour les contrôles de pagination
            function updatePagination() {
                var pageCount = Math.ceil(rowsCount / itemsPerPage);
                var paginationControls = $('#paginationControls ul');
                
                paginationControls.empty();
                
                // Bouton Précédent
                paginationControls.append(
                    `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" data-page="${currentPage - 1}">Précédent</a>
                    </li>`
                );
                
                // Boutons des pages
                for (var i = 1; i <= pageCount; i++) {
                    paginationControls.append(
                        `<li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" data-page="${i}">${i}</a>
                        </li>`
                    );
                }
                
                // Bouton Suivant
                paginationControls.append(
                    `<li class="page-item ${currentPage === pageCount ? 'disabled' : ''}">
                        <a class="page-link" href="#" data-page="${currentPage + 1}">Suivant</a>
                    </li>`
                );
                
                showPage(currentPage);
            }
            
            // Mettre à jour les infos de pagination
            function updatePaginationInfo() {
                var startItem = ((currentPage - 1) * itemsPerPage) + 1;
                var endItem = Math.min(currentPage * itemsPerPage, rowsCount);
                
                $('#paginationInfo').text(
                    `Affichage de ${startItem} à ${endItem} sur ${rowsCount} entrées`
                );
            }
            
            // Gestion des clics sur la pagination
            $('#paginationControls').on('click', 'a.page-link', function(e) {
                e.preventDefault();
                currentPage = parseInt($(this).data('page'));
                updatePagination();
            });
            
            // Initialisation
            initPagination();
        });
    </script>
}

<style>
    .page-item.active .page-link {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    .page-link {
        color: #0d6efd;
    }
    .dataTables_info {
        padding-top: 0.5rem;
    }
</style>